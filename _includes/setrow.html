<!--build the first two columns-->
<td class="setTitle"><a href="{{ set.url }}">{{ set.title }}</a></td>
<td>{{ set.rhythm }}</td>

<td>
<table style="width: 100%;">
{% for setTune in set.tunes %}
{% assign setTuneURL = setTune | replace: 'md', 'html' | prepend: '/tunes/' %}
{% assign siteTunes = site.tunes | where: 'titleID', setTune %}
{% for tune in siteTunes %}
<tr style="height: 77px; background-color:transparent;"><td  style="vertical-align: center;">
<a href="{{ setTuneURL | absolute_url }}">{{ tune.title | escape }} ({{ tune.key}})</a>
</td></tr>
{% endfor %}
{% endfor %}
</table>
</td>

<td>
<table style="width: 100%;">
{% assign setTuneID = include.setId | times: 10 %}
{% for setTune in set.tunes %}
{% assign setTuneID = setTuneID | plus: 1 %}
{% assign siteTunes = site.tunes | where: 'titleID', setTune %}
{% for tune in siteTunes %}
<tr style="background-color:transparent;">
{% if tune.mp3_file contains "mp3" %}
<td id="showPlayer{{ setTuneID }}">
<script>
var context = new AudioContext();

showPlayer{{ setTuneID }}.innerHTML = createMP3player('{{setTuneID}}', '{{ site.mp3_host }}{{ tune.mp3_file }}', 'mp3player_tablerow');

// One-liner to resume playback when user interacted with the page
document.querySelector('button').addEventListener('click', function() {
    context.resume().then(() => {
        console.log('Playback button selected');
    });
});
</script>
{% else %}
<td id="showPlayer{{ setTuneID }}">
<script>
var context = new AudioContext();

<!--unroll ABC to handle repeats and different endings for parts-->
textAreas.innerHTML += '<textarea id="{{'ABC' | append: setTuneID }}" style="display:none;">' + preProcessABC({{ tune.abc | jsonify }}) + '</textarea>';
showPlayer{{ setTuneID }}.innerHTML = createABCplayer('{{ setTuneID }}', 'abcplayer_tablerow', '{{ site.defaultABCplayer }}');

// One-liner to resume playback when user interacted with the page
document.querySelector('button').addEventListener('click', function() {
    context.resume().then(() => {
        console.log('Playback button selected');
    });
});
</script>
{% endif %}
</td></tr>
{% endfor %}
{% endfor %}
</table>
</td>
